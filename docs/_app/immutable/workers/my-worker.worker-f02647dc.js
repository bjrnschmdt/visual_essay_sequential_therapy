var pe=Object.defineProperty;var be=(w,$,I)=>$ in w?pe(w,$,{enumerable:!0,configurable:!0,writable:!0,value:I}):w[$]=I;var g=(w,$,I)=>(be(w,typeof $!="symbol"?$+"":$,I),I);(function(){"use strict";Promise.resolve();function w(t,n){return t==null||n==null?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function $(t,n){return t==null||n==null?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function I(t){let n,e,r;t.length!==2?(n=w,e=(f,u)=>w(t(f),u),r=(f,u)=>t(f)-u):(n=t===w||t===$?t:tn,e=t,r=t);function i(f,u,s=0,l=f.length){if(s<l){if(n(u,u)!==0)return l;do{const h=s+l>>>1;e(f[h],u)<0?s=h+1:l=h}while(s<l)}return s}function o(f,u,s=0,l=f.length){if(s<l){if(n(u,u)!==0)return l;do{const h=s+l>>>1;e(f[h],u)<=0?s=h+1:l=h}while(s<l)}return s}function a(f,u,s=0,l=f.length){const h=i(f,u,s,l-1);return h>s&&r(f[h-1],u)>-r(f[h],u)?h-1:h}return{left:i,center:a,right:o}}function tn(){return 0}function nn(t){return t===null?NaN:+t}const en=I(w).right;I(nn).center;var rn=en;const on=Math.sqrt(50),an=Math.sqrt(10),fn=Math.sqrt(2);function J(t,n,e){const r=(n-t)/Math.max(0,e),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=on?10:o>=an?5:o>=fn?2:1;let f,u,s;return i<0?(s=Math.pow(10,-i)/a,f=Math.round(t*s),u=Math.round(n*s),f/s<t&&++f,u/s>n&&--u,s=-s):(s=Math.pow(10,i)*a,f=Math.round(t/s),u=Math.round(n/s),f*s<t&&++f,u*s>n&&--u),u<f&&.5<=e&&e<2?J(t,n,e*2):[f,u,s]}function sn(t,n,e){if(n=+n,t=+t,e=+e,!(e>0))return[];if(t===n)return[t];const r=n<t,[i,o,a]=r?J(n,t,e):J(t,n,e);if(!(o>=i))return[];const f=o-i+1,u=new Array(f);if(r)if(a<0)for(let s=0;s<f;++s)u[s]=(o-s)/-a;else for(let s=0;s<f;++s)u[s]=(o-s)*a;else if(a<0)for(let s=0;s<f;++s)u[s]=(i+s)/-a;else for(let s=0;s<f;++s)u[s]=(i+s)*a;return u}function ut(t,n,e){return n=+n,t=+t,e=+e,J(t,n,e)[2]}function un(t,n,e){n=+n,t=+t,e=+e;const r=n<t,i=r?ut(n,t,e):ut(t,n,e);return(r?-1:1)*(i<0?1/-i:i)}var hn=ln(Math.random);function ln(t){return function(e,r=0,i=e.length){let o=i-(r=+r);for(;o;){const a=t()*o--|0,f=e[o+r];e[o+r]=e[a+r],e[a+r]=f}return e}}function ht(t,n,e){t.prototype=n.prototype=e,e.constructor=t}function It(t,n){var e=Object.create(t.prototype);for(var r in n)e[r]=n[r];return e}function F(){}var D=.7,K=1/D,z="\\s*([+-]?\\d+)\\s*",X="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",M="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",cn=/^#([0-9a-f]{3,8})$/,dn=new RegExp(`^rgb\\(${z},${z},${z}\\)$`),gn=new RegExp(`^rgb\\(${M},${M},${M}\\)$`),xn=new RegExp(`^rgba\\(${z},${z},${z},${X}\\)$`),mn=new RegExp(`^rgba\\(${M},${M},${M},${X}\\)$`),pn=new RegExp(`^hsl\\(${X},${M},${M}\\)$`),bn=new RegExp(`^hsla\\(${X},${M},${M},${X}\\)$`),Ct={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ht(F,T,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:St,formatHex:St,formatHex8:yn,formatHsl:wn,formatRgb:At,toString:At});function St(){return this.rgb().formatHex()}function yn(){return this.rgb().formatHex8()}function wn(){return zt(this).formatHsl()}function At(){return this.rgb().formatRgb()}function T(t){var n,e;return t=(t+"").trim().toLowerCase(),(n=cn.exec(t))?(e=n[1].length,n=parseInt(n[1],16),e===6?Rt(n):e===3?new m(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):e===8?Q(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):e===4?Q(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=dn.exec(t))?new m(n[1],n[2],n[3],1):(n=gn.exec(t))?new m(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=xn.exec(t))?Q(n[1],n[2],n[3],n[4]):(n=mn.exec(t))?Q(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=pn.exec(t))?Ht(n[1],n[2]/100,n[3]/100,1):(n=bn.exec(t))?Ht(n[1],n[2]/100,n[3]/100,n[4]):Ct.hasOwnProperty(t)?Rt(Ct[t]):t==="transparent"?new m(NaN,NaN,NaN,0):null}function Rt(t){return new m(t>>16&255,t>>8&255,t&255,1)}function Q(t,n,e,r){return r<=0&&(t=n=e=NaN),new m(t,n,e,r)}function Mn(t){return t instanceof F||(t=T(t)),t?(t=t.rgb(),new m(t.r,t.g,t.b,t.opacity)):new m}function S(t,n,e,r){return arguments.length===1?Mn(t):new m(t,n,e,r??1)}function m(t,n,e,r){this.r=+t,this.g=+n,this.b=+e,this.opacity=+r}ht(m,S,It(F,{brighter(t){return t=t==null?K:Math.pow(K,t),new m(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?D:Math.pow(D,t),new m(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new m(A(this.r),A(this.g),A(this.b),W(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Pt,formatHex:Pt,formatHex8:vn,formatRgb:Et,toString:Et}));function Pt(){return`#${R(this.r)}${R(this.g)}${R(this.b)}`}function vn(){return`#${R(this.r)}${R(this.g)}${R(this.b)}${R((isNaN(this.opacity)?1:this.opacity)*255)}`}function Et(){const t=W(this.opacity);return`${t===1?"rgb(":"rgba("}${A(this.r)}, ${A(this.g)}, ${A(this.b)}${t===1?")":`, ${t})`}`}function W(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function A(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function R(t){return t=A(t),(t<16?"0":"")+t.toString(16)}function Ht(t,n,e,r){return r<=0?t=n=e=NaN:e<=0||e>=1?t=n=NaN:n<=0&&(t=NaN),new y(t,n,e,r)}function zt(t){if(t instanceof y)return new y(t.h,t.s,t.l,t.opacity);if(t instanceof F||(t=T(t)),!t)return new y;if(t instanceof y)return t;t=t.rgb();var n=t.r/255,e=t.g/255,r=t.b/255,i=Math.min(n,e,r),o=Math.max(n,e,r),a=NaN,f=o-i,u=(o+i)/2;return f?(n===o?a=(e-r)/f+(e<r)*6:e===o?a=(r-n)/f+2:a=(n-e)/f+4,f/=u<.5?o+i:2-o-i,a*=60):f=u>0&&u<1?0:a,new y(a,f,u,t.opacity)}function kn(t,n,e,r){return arguments.length===1?zt(t):new y(t,n,e,r??1)}function y(t,n,e,r){this.h=+t,this.s=+n,this.l=+e,this.opacity=+r}ht(y,kn,It(F,{brighter(t){return t=t==null?K:Math.pow(K,t),new y(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?D:Math.pow(D,t),new y(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,n=isNaN(t)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*n,i=2*e-r;return new m(lt(t>=240?t-240:t+120,i,r),lt(t,i,r),lt(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new y(jt(this.h),tt(this.s),tt(this.l),W(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=W(this.opacity);return`${t===1?"hsl(":"hsla("}${jt(this.h)}, ${tt(this.s)*100}%, ${tt(this.l)*100}%${t===1?")":`, ${t})`}`}}));function jt(t){return t=(t||0)%360,t<0?t+360:t}function tt(t){return Math.max(0,Math.min(1,t||0))}function lt(t,n,e){return(t<60?n+(e-n)*t/60:t<180?e:t<240?n+(e-n)*(240-t)/60:n)*255}var ct=t=>()=>t;function Nn(t,n){return function(e){return t+e*n}}function $n(t,n,e){return t=Math.pow(t,e),n=Math.pow(n,e)-t,e=1/e,function(r){return Math.pow(t+r*n,e)}}function Bn(t){return(t=+t)==1?qt:function(n,e){return e-n?$n(n,e,t):ct(isNaN(n)?e:n)}}function qt(t,n){var e=n-t;return e?Nn(t,e):ct(isNaN(t)?n:t)}var dt=function t(n){var e=Bn(n);function r(i,o){var a=e((i=S(i)).r,(o=S(o)).r),f=e(i.g,o.g),u=e(i.b,o.b),s=qt(i.opacity,o.opacity);return function(l){return i.r=a(l),i.g=f(l),i.b=u(l),i.opacity=s(l),i+""}}return r.gamma=t,r}(1);function In(t,n){n||(n=[]);var e=t?Math.min(n.length,t.length):0,r=n.slice(),i;return function(o){for(i=0;i<e;++i)r[i]=t[i]*(1-o)+n[i]*o;return r}}function Cn(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Sn(t,n){var e=n?n.length:0,r=t?Math.min(e,t.length):0,i=new Array(r),o=new Array(e),a;for(a=0;a<r;++a)i[a]=mt(t[a],n[a]);for(;a<e;++a)o[a]=n[a];return function(f){for(a=0;a<r;++a)o[a]=i[a](f);return o}}function An(t,n){var e=new Date;return t=+t,n=+n,function(r){return e.setTime(t*(1-r)+n*r),e}}function nt(t,n){return t=+t,n=+n,function(e){return t*(1-e)+n*e}}function Rn(t,n){var e={},r={},i;(t===null||typeof t!="object")&&(t={}),(n===null||typeof n!="object")&&(n={});for(i in n)i in t?e[i]=mt(t[i],n[i]):r[i]=n[i];return function(o){for(i in e)r[i]=e[i](o);return r}}var gt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,xt=new RegExp(gt.source,"g");function Pn(t){return function(){return t}}function En(t){return function(n){return t(n)+""}}function Hn(t,n){var e=gt.lastIndex=xt.lastIndex=0,r,i,o,a=-1,f=[],u=[];for(t=t+"",n=n+"";(r=gt.exec(t))&&(i=xt.exec(n));)(o=i.index)>e&&(o=n.slice(e,o),f[a]?f[a]+=o:f[++a]=o),(r=r[0])===(i=i[0])?f[a]?f[a]+=i:f[++a]=i:(f[++a]=null,u.push({i:a,x:nt(r,i)})),e=xt.lastIndex;return e<n.length&&(o=n.slice(e),f[a]?f[a]+=o:f[++a]=o),f.length<2?u[0]?En(u[0].x):Pn(n):(n=u.length,function(s){for(var l=0,h;l<n;++l)f[(h=u[l]).i]=h.x(s);return f.join("")})}function mt(t,n){var e=typeof n,r;return n==null||e==="boolean"?ct(n):(e==="number"?nt:e==="string"?(r=T(n))?(n=r,dt):Hn:n instanceof T?dt:n instanceof Date?An:Cn(n)?In:Array.isArray(n)?Sn:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?Rn:nt)(t,n)}function zn(t,n){return t=+t,n=+n,function(e){return Math.round(t*(1-e)+n*e)}}var pt=3;(function t(n){n=+n;function e(r){return Math.pow(r,n)}return e.exponent=t,e})(pt),function t(n){n=+n;function e(r){return 1-Math.pow(1-r,n)}return e.exponent=t,e}(pt);var jn=function t(n){n=+n;function e(r){return((r*=2)<=1?Math.pow(r,n):2-Math.pow(2-r,n))/2}return e.exponent=t,e}(pt);function qn(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function et(t,n){if((e=(t=n?t.toExponential(n-1):t.toExponential()).indexOf("e"))<0)return null;var e,r=t.slice(0,e);return[r.length>1?r[0]+r.slice(2):r,+t.slice(e+1)]}function j(t){return t=et(Math.abs(t)),t?t[1]:NaN}function Yn(t,n){return function(e,r){for(var i=e.length,o=[],a=0,f=t[0],u=0;i>0&&f>0&&(u+f+1>r&&(f=Math.max(1,r-u)),o.push(e.substring(i-=f,i+f)),!((u+=f+1)>r));)f=t[a=(a+1)%t.length];return o.reverse().join(n)}}function On(t){return function(n){return n.replace(/[0-9]/g,function(e){return t[+e]})}}var Fn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function rt(t){if(!(n=Fn.exec(t)))throw new Error("invalid format: "+t);var n;return new bt({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}rt.prototype=bt.prototype;function bt(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}bt.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Dn(t){t:for(var n=t.length,e=1,r=-1,i;e<n;++e)switch(t[e]){case".":r=i=e;break;case"0":r===0&&(r=e),i=e;break;default:if(!+t[e])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var Yt;function Xn(t,n){var e=et(t,n);if(!e)return t+"";var r=e[0],i=e[1],o=i-(Yt=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+et(t,Math.max(0,n+o-1))[0]}function Ot(t,n){var e=et(t,n);if(!e)return t+"";var r=e[0],i=e[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}var Ft={"%":(t,n)=>(t*100).toFixed(n),b:t=>Math.round(t).toString(2),c:t=>t+"",d:qn,e:(t,n)=>t.toExponential(n),f:(t,n)=>t.toFixed(n),g:(t,n)=>t.toPrecision(n),o:t=>Math.round(t).toString(8),p:(t,n)=>Ot(t*100,n),r:Ot,s:Xn,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Dt(t){return t}var Xt=Array.prototype.map,Tt=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Tn(t){var n=t.grouping===void 0||t.thousands===void 0?Dt:Yn(Xt.call(t.grouping,Number),t.thousands+""),e=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?Dt:On(Xt.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",f=t.minus===void 0?"−":t.minus+"",u=t.nan===void 0?"NaN":t.nan+"";function s(h){h=rt(h);var d=h.fill,k=h.align,N=h.sign,V=h.symbol,Y=h.zero,Z=h.width,Bt=h.comma,E=h.precision,Jt=h.trim,p=h.type;p==="n"?(Bt=!0,p="g"):Ft[p]||(E===void 0&&(E=12),Jt=!0,p="g"),(Y||d==="0"&&k==="=")&&(Y=!0,d="0",k="=");var ge=V==="$"?e:V==="#"&&/[boxX]/.test(p)?"0"+p.toLowerCase():"",xe=V==="$"?r:/[%p]/.test(p)?a:"",Kt=Ft[p],me=/[defgprs%]/.test(p);E=E===void 0?6:/[gprs]/.test(p)?Math.max(1,Math.min(21,E)):Math.max(0,Math.min(20,E));function Qt(c){var H=ge,b=xe,O,Wt,at;if(p==="c")b=Kt(c)+b,c="";else{c=+c;var ft=c<0||1/c<0;if(c=isNaN(c)?u:Kt(Math.abs(c),E),Jt&&(c=Dn(c)),ft&&+c==0&&N!=="+"&&(ft=!1),H=(ft?N==="("?N:f:N==="-"||N==="("?"":N)+H,b=(p==="s"?Tt[8+Yt/3]:"")+b+(ft&&N==="("?")":""),me){for(O=-1,Wt=c.length;++O<Wt;)if(at=c.charCodeAt(O),48>at||at>57){b=(at===46?i+c.slice(O+1):c.slice(O))+b,c=c.slice(0,O);break}}}Bt&&!Y&&(c=n(c,1/0));var st=H.length+c.length+b.length,B=st<Z?new Array(Z-st+1).join(d):"";switch(Bt&&Y&&(c=n(B+c,B.length?Z-b.length:1/0),B=""),k){case"<":c=H+c+b+B;break;case"=":c=H+B+c+b;break;case"^":c=B.slice(0,st=B.length>>1)+H+c+b+B.slice(st);break;default:c=B+H+c+b;break}return o(c)}return Qt.toString=function(){return h+""},Qt}function l(h,d){var k=s((h=rt(h),h.type="f",h)),N=Math.max(-8,Math.min(8,Math.floor(j(d)/3)))*3,V=Math.pow(10,-N),Y=Tt[8+N/3];return function(Z){return k(V*Z)+Y}}return{format:s,formatPrefix:l}}var it,Ut,Lt;Un({thousands:",",grouping:[3],currency:["$",""]});function Un(t){return it=Tn(t),Ut=it.format,Lt=it.formatPrefix,it}function Ln(t){return Math.max(0,-j(Math.abs(t)))}function Gn(t,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(j(n)/3)))*3-j(Math.abs(t)))}function _n(t,n){return t=Math.abs(t),n=Math.abs(n)-t,Math.max(0,j(n)-j(t))+1}function Vn(t,n){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(n).domain(t);break}return this}function Zn(t){return function(){return t}}function Jn(t){return+t}var Gt=[0,1];function q(t){return t}function yt(t,n){return(n-=t=+t)?function(e){return(e-t)/n}:Zn(isNaN(n)?NaN:.5)}function Kn(t,n){var e;return t>n&&(e=t,t=n,n=e),function(r){return Math.max(t,Math.min(n,r))}}function Qn(t,n,e){var r=t[0],i=t[1],o=n[0],a=n[1];return i<r?(r=yt(i,r),o=e(a,o)):(r=yt(r,i),o=e(o,a)),function(f){return o(r(f))}}function Wn(t,n,e){var r=Math.min(t.length,n.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());++a<r;)i[a]=yt(t[a],t[a+1]),o[a]=e(n[a],n[a+1]);return function(f){var u=rn(t,f,1,r)-1;return o[u](i[u](f))}}function te(t,n){return n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ne(){var t=Gt,n=Gt,e=mt,r,i,o,a=q,f,u,s;function l(){var d=Math.min(t.length,n.length);return a!==q&&(a=Kn(t[0],t[d-1])),f=d>2?Wn:Qn,u=s=null,h}function h(d){return d==null||isNaN(d=+d)?o:(u||(u=f(t.map(r),n,e)))(r(a(d)))}return h.invert=function(d){return a(i((s||(s=f(n,t.map(r),nt)))(d)))},h.domain=function(d){return arguments.length?(t=Array.from(d,Jn),l()):t.slice()},h.range=function(d){return arguments.length?(n=Array.from(d),l()):n.slice()},h.rangeRound=function(d){return n=Array.from(d),e=zn,l()},h.clamp=function(d){return arguments.length?(a=d?!0:q,l()):a!==q},h.interpolate=function(d){return arguments.length?(e=d,l()):e},h.unknown=function(d){return arguments.length?(o=d,h):o},function(d,k){return r=d,i=k,l()}}function ee(){return ne()(q,q)}function re(t,n,e,r){var i=un(t,n,e),o;switch(r=rt(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(n));return r.precision==null&&!isNaN(o=Gn(i,a))&&(r.precision=o),Lt(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=_n(i,Math.max(Math.abs(t),Math.abs(n))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=Ln(i))&&(r.precision=o-(r.type==="%")*2);break}}return Ut(r)}function ie(t){var n=t.domain;return t.ticks=function(e){var r=n();return sn(r[0],r[r.length-1],e??10)},t.tickFormat=function(e,r){var i=n();return re(i[0],i[i.length-1],e??10,r)},t.nice=function(e){e==null&&(e=10);var r=n(),i=0,o=r.length-1,a=r[i],f=r[o],u,s,l=10;for(f<a&&(s=a,a=f,f=s,s=i,i=o,o=s);l-- >0;){if(s=ut(a,f,e),s===u)return r[i]=a,r[o]=f,n(r);if(s>0)a=Math.floor(a/s)*s,f=Math.ceil(f/s)*s;else if(s<0)a=Math.ceil(a*s)/s,f=Math.floor(f*s)/s;else break;u=s}return t},t}function wt(){var t=ee();return t.copy=function(){return te(t,wt())},Vn.apply(t,arguments),ie(t)}function U(t,n,e){this.k=t,this.x=n,this.y=e}U.prototype={constructor:U,scale:function(t){return t===1?this:new U(this.k*t,this.x,this.y)},translate:function(t,n){return t===0&n===0?this:new U(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},U.prototype;const Mt=new Uint8Array(256);for(let t=0;t<256;++t)Mt[t]=t;hn(Mt);const C=new Uint8Array(512);for(let t=0;t<256;++t)C[t]=C[t+256]=Mt[t];function oe(t,n){const e=Math.floor(t),r=Math.floor(n),i=e&255,o=r&255,a=_t(t-=e),f=_t(n-=r),u=C[i]+o,s=C[i+1]+o;return vt(f,vt(a,ot(C[u],t,n),ot(C[s],t-1,n)),vt(a,ot(C[u+1],t,n-1),ot(C[s+1],t-1,n-1)))}function ae(t,n){return function(e,r,i){let o=0,a=1,f=1,u=0;for(let s=0;s<n;++s)u+=t(e*a,r*a,i*a)*f,o+=f,f*=.5,a*=2;return u/o}}function ot(t,n,e){const r=t&1?e:n;return t&2?-r:r}function _t(t){return t*t*t*(t*(t*6-15)+10)}function vt(t,n,e){return n+t*(e-n)}const fe=ae(oe,5);function Vt(t,n,e){const r=Math.round(t.r*n.r/255*e),i=Math.round(t.g*n.g/255*e),o=Math.round(t.b*n.b/255*e);return S(r,i,o)}function Zt(t,n,e){let r=fe(t*e,n*e*.5),i=Math.round(ue(r));return S(i,i,i)}const _=class{constructor(n,e,r,i,o,a){g(this,"init",()=>{for(let n=0;n<_.lifetime;n++)this.setColor(n);this.boundingBox=this.computeBoundingBox()});g(this,"getPos",()=>[this.x,this.y]);g(this,"computeBoundingBox",()=>{let n=1/0,e=1/0,r=-1/0,i=-1/0;for(let o=0;o<this.polygon.length;o++)n=Math.min(n,this.polygon[o][0]),e=Math.min(e,this.polygon[o][1]),r=Math.max(r,this.polygon[o][0]),i=Math.max(i,this.polygon[o][1]);return{minX:n,minY:e,maxX:r,maxY:i}});g(this,"getBoundingBox",()=>this.boundingBox);g(this,"getColor",n=>this.state.length<_.lifetime?(console.log("Cell is still being computed"),this.color[0]):this.isAlive(n)?this.color[this.getCurrentStateIndex(n)]:this.isDead(n)?this.color.slice(-1)[0]:this.color[0]);g(this,"setColor",n=>{let r=jn.exponent(_.growthExponent)(se(n));const i=dt(this.colorBaseComp,this.colorBactComp);this.color[n]=i(r)});g(this,"getIndex",()=>this.index);g(this,"getPrevious",n=>this.state[n-1]);g(this,"getCurrent",n=>this.state[n]);g(this,"getState",n=>this.state[n]);g(this,"getPreviousStateIndex",n=>this.state.indexOf(n-1));g(this,"getCurrentStateIndex",n=>this.state.indexOf(n));g(this,"setCurrent",(n,e)=>{this.state[n]=e});g(this,"isAlive",n=>this.state.includes(n));g(this,"isDead",n=>this.state.length===0?!1:!this.isAlive(n)&&n>this.state.slice(-1)[0]);this.x=n,this.y=e,this.index=r,this.polygon=i,this.neighbors=o,this.medium=a,this.state=[],this.color=[],this.noiseBaseScale=.001,this.noiseBactScale=.008,this.noiseBaseFactor=.5,this.noiseBactFactor=.9,this.noiseBase=Zt(this.x,this.y,this.noiseBaseScale),this.noiseBact=Zt(this.x,this.y,this.noiseBactScale),this.colorBase=S(105,105,105),this.colorBact=S(a),this.colorBaseComp=Vt(this.colorBase,this.noiseBase,this.noiseBaseFactor),this.colorBactComp=Vt(this.colorBact,this.noiseBact,this.noiseBactFactor),this.boundingBox=null,this.init()}};let v=_;g(v,"r",1),g(v,"lifetime",24),g(v,"growthExponent",4),g(v,"threshold",2);var se=wt().domain([0,v.lifetime]).range([0,1]),ue=wt().domain([-1,1]).range([0,255]);const he=3e3;let kt=0,x=[],P=[],L=new Set,G=new Set,Nt=new Set,$t=[];onmessage=t=>{const{type:n,data:e}=t.data;switch(n){case"addCell":const{x:r,y:i,index:o,polygon:a,neighbors:f,medium:u}=e;x.push(new v(r,i,o,a,f,u)),P.push({index:o,boundingBox:x[o].getBoundingBox(),color:x[o].color,state:x[o].state,medium:u});break;case"initCell":const{startIndex:s}=e;x[s].setCurrent(1,0),L.add(s);for(const k of x[s].neighbors)x[k].setCurrent(0,0),G.add(k);break;case"initCells":le(x);break;case"getInitialCellsData":postMessage({type:"setInitialCellsData",data:P});break;case"generate":const{startGen:l,numGens:h,mediumCounts:d}=e;ce(l,h);break;default:console.error(`Unknown message type: ${n}`)}};function le(t){const n=t.reduce((e,r)=>(e[r.medium]?r.boundingBox.minY<e[r.medium].boundingBox.minY&&(e[r.medium]=r):e[r.medium]=r,e),{});t.reduce((e,r)=>(e[r.medium]?r.boundingBox.maxY>e[r.medium].boundingBox.maxY&&(e[r.medium]=r):e[r.medium]=r,e),{});for(const[e,r]of Object.entries(n)){r.setCurrent(1,Math.floor(r.boundingBox.minY/10)),L.add(r.index);for(const o of r.neighbors)t[o].medium===r.medium&&(t[o].setCurrent(0,Math.floor(r.boundingBox.minY/10)),G.add(o))}}function ce(t,n,e){let r=new Set([...L]),i=new Set([...G]);for(let o=t;o<t+n;o++){for(let a of G)for(const f of x[a].neighbors)!x[f].isAlive(o-1)&&x[f].medium===x[a].medium&&de(x[f],o,i,r);for(let a of L){const f=x[a];let u=f.getPreviousStateIndex(o);u+1<v.lifetime?(f.setCurrent(u+1,o),P[a].state[u+1]=o,P[a].color[u+1]=f.color[u+1],u===0&&i.delete(a)):r.delete(a)}r.forEach(a=>{Nt.add(a),kt++}),kt>=he&&(Nt.forEach(a=>{$t.push(P[a])}),postMessage({type:"updateCells",data:{batchUpdates:$t,gen:o}}),Nt.clear(),$t=[],kt=0),L=r,G=i}}function de(t,n,e,r){let i=0;for(const o of t.neighbors)x[o].isAlive(n-1)&&(i+=1);i>=v.threshold&&(t.setCurrent(0,n),e.add(t.getIndex()),r.add(t.getIndex()),P[t.getIndex()].state[0]=n,P[t.getIndex()].color[0]=t.color[0])}})();
